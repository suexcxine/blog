title: <<The Linux Command Line>> 第十六章笔记 存储媒介
date: 2015-09-07 20:00:16
tags: [linux, bash]
---
## /etc/fstab
/etc/fstab 的文件可以列出系统启动时要挂载的设备（典型地，硬盘分区）
/etc/fstab 字段
* 设备名     传统上，这个字段包含与物理设备相关联的设备文件的实际名字，比如说/dev/hda1（第一个 IDE 通道上第一个主设备分区）。然而今天的计算机，有很多热插拔设备（像 USB 驱动设备），许多 现代的 Linux 发行版用一个文本标签和设备相关联。当这个设备连接到系统中时， 这个标签（当储存媒介格式化时，这个标签会被添加到存储媒介中）会被操作系统读取。 那样的话，不管赋给实际物理设备哪个设备文件，这个设备仍然能被系统正确地识别。
* 挂载点     设备所连接到的文件系统树的目录。
* 文件系统类型     Linux 允许挂载许多文件系统类型。大多数本地的 Linux 文件系统是 ext3， 但是也支持很多其它的，比方说 FAT16 (msdos), FAT32 (vfat)，NTFS (ntfs)，CD-ROM (iso9660)，等等。
* 选项     文件系统可以通过各种各样的选项来挂载。有可能，例如，挂载只读的文件系统， 或者挂载阻止执行任何程序的文件系统（一个有用的安全特性，避免删除媒介。）
* 频率     一位数字，指定是否和在什么时间用 dump 命令来备份一个文件系统。
* 次序     一位数字，指定 fsck 命令按照什么次序来检查文件系统。

## mount & umount
用来挂载文件系统。执行这个不带参数的命令，将会显示 一系列当前挂载的文件系统

一个挂载点就是文件系统树中的一个目录。它没有 什么特殊的。
它甚至不必是一个空目录，即使你把设备挂载到了一个非空目录上，你也不能看到 这个目录中原来的内容，直到你卸载这个设备。

我们不能卸载一个设备，如果某个用户或进程正在使用这个设备的话。
在这种 情况下，我们把工作目录更改到了 CD-ROW 的挂载点，这个挂载点导致设备忙碌。
我们可以很容易地修复这个问题 通过把工作目录改到其它目录而不是这个挂载点。
umount很重要,如果不umount可能会丢失缓冲区中的暂未发往设备的数据

## Linux 存储设备名称
* /dev/fd*     软盘驱动器
* /dev/hd*     老系统中的 IDE(PATA)磁盘。典型的主板包含两个 IDE 连接器或者是通道，每个连接器 带有一根缆线，每根缆线上有两个硬盘驱动器连接点。缆线上的第一个驱动器叫做主设备， 第二个叫做从设备。
* 设备名称这样安排，/dev/hda 是指第一通道上的主设备名；/dev/hdb 是第一通道上的从设备名；/dev/hdc 是第二通道上的主设备名，等等。末尾的数字表示 硬盘驱动器上的分区。例如，/dev/hda1是指系统中第一硬盘驱动器上的第一个分区，而 /dev/hda 则是指整个硬盘驱动器。
* /dev/lp*     打印机
* /dev/sd*     SCSI 磁盘。在最近的 Linux 系统中，内核把所有类似于磁盘的设备（包括 PATA/SATA 硬盘， 闪存，和 USB 存储设备，比如说可移动的音乐播放器和数码相机）看作 SCSI 磁盘。 剩下的命名系统类似于上述所描述的旧的/dev/hd*命名方案。
* /dev/sr*     光盘（CD/DVD 读取器和烧写器）

## fsck
除了检查文件系统的完整性之外，fsck 还能修复受损的文件系统，其成功度依赖于损坏的数量。 
在类 Unix 的文件系统中，文件恢复的部分被放置于 lost+found 目录里面，位于每个文件 系统的根目录下面。

## dd
直接把数据移入/出设备
把第一个驱动器中的所有数据复制到第二个 驱动器中
dd if=/dev/sdb of=/dev/sdc
如果只有第一个驱动器被连接到计算机上，我们可以把它的内容复制到一个普通文件中供 以后恢复或复制数据
dd if=/dev/sdb of=flash_drive.img
警告！这个 dd 命令非常强大。虽然它的名字来自于“数据定义”，有时候也把它叫做“清除磁盘” 因为用户经常会误输入 if 或 of 的规范。在按下回车键之前，要再三检查输入与输出规范！

通过CD-ROM制作iso
dd if=/dev/cdrom of=ubuntu.iso
这项技术也适用于 DVD 光盘，但是不能用于音频 CD，因为它们不使用文件系统来存储数据。 对于音频 CD，看一下 cdrdao 命令。

## genisoimage 
创建一个包含目录内容的 iso 映像文件，我们使用 genisoimage 程序。
为此，我们首先创建 一个目录，这个目录中包含了要包括到此映像中的所有文件，然后执行这个 genisoimage 命令 来创建映像文件。
例如，如果我们已经创建一个叫做~/cd-rom-files 的目录，然后用文件 填充此目录，再通过下面的命令来创建一个叫做 cd-rom.iso 映像文件：
genisoimage -o cd-rom.iso -R -J ~/cd-rom-files
“-R”选项添加元数据为 Rock Ridge 扩展，这允许使用长文件名和 POSIX 风格的文件权限。 
同样地，这个”-J”选项使 Joliet 扩展生效，这样 Windows 中就支持长文件名了。

## 直接挂载一个 ISO 镜像
有一个诀窍，我们可以用它来挂载 iso 映像文件，虽然此文件仍然在我们的硬盘中，但我们 当作它已经在光盘中了。
添加 “-o loop” 选项来挂载（同时带有必需的 “-t iso9660” 文件系统类型）， 挂载这个映像文件就好像它是一台设备，把它连接到文件系统树上：
mkdir /mnt/iso_image
mount -t iso9660 -o loop image.iso /mnt/iso_image

## wodim 
清除一张可重写入的 CD-ROM
可重写入的 CD-RW 媒介在被重使用之前需要擦除或清空。
为此，我们可以用 wodim 命令，指定 设备名称和清空的类型。此 wodim 程序提供了几种清空类型。最小（且最快）的是 “fast” 类型：
wodim dev=/dev/cdrw blank=fast

写入一个映像文件，我们再次使用 wodim 命令，指定光盘设备名称和映像文件名：
wodim dev=/dev/cdrw image.iso

## md5sum检验完整性
一个以 disk-at-once 模式写入的 CD-R，可以用下面的方式检验完整性
md5sum /dev/cdrom
34e354760f9bb7fbf85c96f6a3f94ece    /dev/cdrom
与iso文件的md5sum对比即可

