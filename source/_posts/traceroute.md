title: traceroute
date: 2016-06-06 20:55:00
tags: [internet]
---

Traceroute(windows里是tracert)用来侦测源主机到目的主机之间经过的路径。
<!--more-->

## 原理

Traceroute 使用 ICMP 报文和 IP 首部中的 TTL 字段，它充分利用了 ICMP 超时消息。
其原理是，开始时发送一个 TTL 字段为 1 的 UDP 数据报，而后每次收到 ICMP 超时后，按顺序再发送一个 TTL 字段加 1 的 UDP 数据报，以确定路径中的每个路由器，
而每个路由器在丢弃 UDP 数据报时都会返回一个 ICMP 超时报文，
而最终到达目的主机后，由于 ICMP选择了一个不可能的值作为 UDP 端口(大于30000)。
这样目的主机就会发送一个端口不可达的 ICMP 差错报文。这样就知道已经到达目的主机, 不必再继续循环了。

一条路径上的每个设备traceroute默认要测3次。
输出结果中包括每次测试的时间(ms)和设备的名称（如有的话）及其IP地址。

## 使用
```
$ traceroute -n -q 2 -m 20 suexcxine.cc
traceroute to suexcxine.cc (118.193.216.246), 20 hops max, 60 byte packets
 1  192.168.1.1  0.348 ms  0.600 ms
 2  123.120.0.1  6.108 ms  6.188 ms
 3  61.148.163.105  5.917 ms  6.008 ms
 4  124.65.56.117  6.496 ms  6.592 ms
 5  202.106.36.2  6.281 ms  6.382 ms
 6  219.158.6.42  9.513 ms  9.608 ms
 7  219.158.6.42  9.702 ms  9.797 ms
 8  * *
 9  * *
10  * *
11  * *
12  * *
13  * *
14  118.193.216.246  57.480 ms !X  57.475 ms !X

```
以星号表示的行, 可能是防火墙封掉了ICMP的返回信息。

#### 参数
-n 不使用dns, 直接使用ip地址
-q 每个网关发送数据包数量
-m 最大跳数

