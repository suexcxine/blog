title: traceroute
date: 2016-06-06 20:55:00
tags: [internet]
---

Traceroute(windows里是tracert)用来侦测源主机到目的主机之间经过的路径。
<!--more-->

## 原理

Traceroute 使用 ICMP 报文和 IP 首部中的 TTL 字段，它充分利用了 ICMP 超时消息。
其原理是，开始时发送一个 TTL 字段为 1 的 UDP 数据报，而后每次收到 ICMP 超时后，按顺序再发送一个 TTL 字段加 1 的 UDP 数据报，以确定路径中的每个路由器，
而每个路由器在丢弃 UDP 数据报时都会返回一个 ICMP 超时报文，
而最终到达目的主机后，由于 ICMP选择了一个不可能的值作为 UDP 端口(大于30000)。
这样目的主机就会发送一个端口不可达的 ICMP 差错报文。这样就知道已经到达目的主机, 不必再继续循环了。

一条路径上的每个设备traceroute默认要测3次。
输出结果中包括每次测试的时间(ms)和设备的名称（如有的话）及其IP地址。

## 使用
```
$ traceroute -n -q 2 -m 7 suexcxine.cc
traceroute to suexcxine.cc (118.193.216.246), 7 hops max, 60 byte packets
1  192.168.1.1  0.364 ms  0.598 ms
2  123.120.0.1  4.707 ms  4.896 ms
3  61.148.163.105  4.588 ms  4.762 ms
4  124.65.56.117  4.960 ms  8.136 ms
5  202.106.36.2  5.246 ms  5.448 ms
6  219.158.6.42  5.340 ms  9.281 ms
7  219.158.6.42  9.365 ms  9.464 ms
```

#### 参数
-n 不使用dns, 直接使用ip地址
-q 每个网关发送数据包数量
-m 最大跳数

